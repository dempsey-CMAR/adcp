<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Format and Visualize ADCP data • adcp</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Format and Visualize ADCP data">
<meta name="description" content="Facilitates wrangling and analysis of Current data collected as part of the Centre for Marine Applied Research's Coastal Monitoring Program. (Compatible sensors: Workhorse Sentinel Acoustic Doppler Current Profilers.)">
<meta property="og:description" content="Facilitates wrangling and analysis of Current data collected as part of the Centre for Marine Applied Research's Coastal Monitoring Program. (Compatible sensors: Workhorse Sentinel Acoustic Doppler Current Profilers.)">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">adcp</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="articles/cut_function.html">Exploring Base R's cut() function</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="adcp-readme">adcp: README<a class="anchor" aria-label="anchor" href="#adcp-readme"></a>
</h1></div>
<p><img src="reference/figures/README-adcp-hex.png" width="30%" style="display: block; margin: auto;"></p>
<!-- badges: start -->

<!-- badges: end -->
<p>Format and visualize Current data collect by Acoustic Current Doppler Profilers (ADCPs).</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the development version of adcp from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"dempsey-CMAR/adcp"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<p>The Centre for Marine Applied Research (<a href="https://cmar.ca/" class="external-link">CMAR</a>) coordinates an extensive <a href="https://cmar.ca/coastal-monitoring-program/" class="external-link">Coastal Monitoring Program</a> to measure <a href="https://www.goosocean.org/index.php?option=com_content&amp;view=article&amp;id=14&amp;Itemid=114" class="external-link">Essential Ocean Variables</a> from around the coast of Nova Scotia, Canada. There are three main branches of the program: <em>Water Quality</em>, <em>Currents</em>, and <em>Waves</em>. Processed data for each branch can be viewed and downloaded from several sources, as outlined in the <a href="https://github.com/Centre-for-Marine-Applied-Research/strings/blob/master/man/figures/README-access-cheatsheet.pdf" class="external-link">CMAR Report &amp; Data Access Cheat Sheet</a> (download for clickable links).</p>
<p>The <code>adcp</code> package is used to format and visualize data from the <em>Current</em> branch of the Coastal Monitoring Program.</p>
<p><em>Current</em> data is collected with Acoustic Doppler Current Profilers (ADCPs) deployed on the seafloor. An ADCP is a hydroacoustic current meter that measures water velocities over a range of depths. These sensors measure soundwaves scattered back from moving particles in the water column and use the Doppler effect to estimate speed and direction (Figure 1).</p>
<p><img src="reference/figures/README-fig1.jpg" width="65%" style="display: block; margin: auto;"></p>
<p><br> Figure 1: ADCP diagram (not to scale).</p>
<p><br><br></p>
<p>Current data is recorded for vertical bins throughout the water column. The <code>adcp</code> package uses data from the sensor configuration to calculate the bin height above sea floor and the bin depth below the surface (Figure 2). Note that the <em>bin height</em> always refers to the same point in space; the same <em>bin depth</em> can refer to different points due to changing tides.</p>
<p><img src="reference/figures/README-fig2.png" width="100%"></p>
<p>Figure 2: The bin height above the sea floor and the bin depth below the surface are calculated from deployment configurations including the sensor depth, sensor height above the sea floor, first bin range, and bin size.</p>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dempsey-cmar.github.io/adcp/">adcp</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sjmgarnier.github.io/viridis/" class="external-link">viridis</a></span><span class="op">)</span></span></code></pre></div>
<p>Consider an ADCP deployed from January 17, 2019 to March 1, 2019 at Long Beach, St. Mary’s Bay.</p>
<p>The raw .txt file looks like this:</p>
<p><img src="reference/figures/README-fig3.png" width="100%" style="display: block; margin: auto;"></p>
<p>Figure 3: Raw ADCP data file for Long Beach.</p>
<div class="section level3">
<h3 id="import-and-format-data">Import and format data<a class="anchor" aria-label="anchor" href="#import-and-format-data"></a>
</h3>
<p><code>adcp_read_txt</code> reads in the .txt file and applies some formatting. There is a column for the timestamp, ensemble number, and variable measured. Additional columns, labelled <code>V8</code> to <code>Vn</code> hold the measurements for each bin.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"testdata"</span>, package <span class="op">=</span> <span class="st">"adcp"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># deployment metadata from tracking sheet</span></span>
<span><span class="va">metadata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  Depl_ID <span class="op">=</span> <span class="st">"DG009"</span>,</span>
<span>  Waterbody <span class="op">=</span> <span class="st">"St. Mary's Bay"</span>,</span>
<span>  Station_Name <span class="op">=</span> <span class="st">"Long Beach"</span>,</span>
<span>  Inst_Altitude <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  Bin_Size <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  First_Bin_Range <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/adcp_read_txt.html">adcp_read_txt</a></span><span class="op">(</span><span class="va">path</span>, <span class="st">"2019-01-17_Long_Beach.txt"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span>
<span><span class="co">#&gt;          timestamp_ns Num       variable   V8 V9 V10 V11 V12 V13 V14 V15 V16</span></span>
<span><span class="co">#&gt; 1 2019-01-17 10:40:00  17    SensorDepth 0.16 NA  NA  NA  NA  NA  NA  NA  NA</span></span>
<span><span class="co">#&gt; 2 2019-01-17 10:40:00  17     WaterSpeed   NA NA  NA  NA  NA  NA  NA  NA  NA</span></span>
<span><span class="co">#&gt; 3 2019-01-17 10:40:00  17 WaterDirection   NA NA  NA  NA  NA  NA  NA  NA  NA</span></span>
<span><span class="co">#&gt; 4 2019-01-17 10:50:00  18    SensorDepth 0.16 NA  NA  NA  NA  NA  NA  NA  NA</span></span>
<span><span class="co">#&gt; 5 2019-01-17 10:50:00  18     WaterSpeed   NA NA  NA  NA  NA  NA  NA  NA  NA</span></span>
<span><span class="co">#&gt; 6 2019-01-17 10:50:00  18 WaterDirection   NA NA  NA  NA  NA  NA  NA  NA  NA</span></span>
<span><span class="co">#&gt;   V17 V18 V19 V20 V21 V22 V23 V24 V25 V26 V27 V28 V29 V30 V31 V32 V33 V34 V35</span></span>
<span><span class="co">#&gt; 1  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA</span></span>
<span><span class="co">#&gt; 2  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA</span></span>
<span><span class="co">#&gt; 3  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA</span></span>
<span><span class="co">#&gt; 4  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA</span></span>
<span><span class="co">#&gt; 5  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA</span></span>
<span><span class="co">#&gt; 6  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA</span></span>
<span><span class="co">#&gt;   V36 V37 V38 V39 V40 V41 V42 V43 V44 V45 V46 V47 V48 V49 V50 V51 V52 V53 V54</span></span>
<span><span class="co">#&gt; 1  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA</span></span>
<span><span class="co">#&gt; 2  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA</span></span>
<span><span class="co">#&gt; 3  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA</span></span>
<span><span class="co">#&gt; 4  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA</span></span>
<span><span class="co">#&gt; 5  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA</span></span>
<span><span class="co">#&gt; 6  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA</span></span>
<span><span class="co">#&gt;   V55 V56 V57 V58 V59 V60 V61 V62 V63 V64 V65 V66</span></span>
<span><span class="co">#&gt; 1  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA</span></span>
<span><span class="co">#&gt; 2  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA</span></span>
<span><span class="co">#&gt; 3  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA</span></span>
<span><span class="co">#&gt; 4  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA</span></span>
<span><span class="co">#&gt; 5  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA</span></span>
<span><span class="co">#&gt; 6  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA  NA</span></span></code></pre></div>
<p><code>adcp_assign_bin_altitude()</code> re-names the bin columns with the corresponding bin altitude (height above the sea floor), using information from the deployment configuration.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/adcp_assign_altitude.html">adcp_assign_altitude</a></span><span class="op">(</span><span class="va">dat</span>, metadata <span class="op">=</span> <span class="va">metadata</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dat</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;          timestamp_ns Num       variable  1.5 2.5 3.5 4.5 5.5 6.5 7.5</span></span>
<span><span class="co">#&gt; 1 2019-01-17 10:40:00  17    SensorDepth 0.16  NA  NA  NA  NA  NA  NA</span></span>
<span><span class="co">#&gt; 2 2019-01-17 10:40:00  17     WaterSpeed   NA  NA  NA  NA  NA  NA  NA</span></span>
<span><span class="co">#&gt; 3 2019-01-17 10:40:00  17 WaterDirection   NA  NA  NA  NA  NA  NA  NA</span></span>
<span><span class="co">#&gt; 4 2019-01-17 10:50:00  18    SensorDepth 0.16  NA  NA  NA  NA  NA  NA</span></span>
<span><span class="co">#&gt; 5 2019-01-17 10:50:00  18     WaterSpeed   NA  NA  NA  NA  NA  NA  NA</span></span>
<span><span class="co">#&gt; 6 2019-01-17 10:50:00  18 WaterDirection   NA  NA  NA  NA  NA  NA  NA</span></span></code></pre></div>
<p>The centre of the first bin is 1.5 m from the sea floor; the centre of the second bin is 2.5 m from the sea floor, etc.</p>
<p><code><a href="reference/adcp_correct_timestamp.html">adcp_correct_timestamp()</a></code> converts the timestamp to UTC.</p>
<p>The timestamp column of the raw data is in the timezone of the deployment date (e.g., “AST” if deployed in November to March and “DST” if deployed in March to November). The timestamp does NOT account for changes in daylight savings time.</p>
<p>adcp_correct_timestamp() converts each timestamp to true UTC by adding 3 hours if the deployment date was during daylight savings, or 4 hours if the deployment date was during Atlantic Standard Time.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/adcp_correct_timestamp.html">adcp_correct_timestamp</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dat</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;         timestamp_utc Num       variable  1.5 2.5 3.5 4.5 5.5 6.5 7.5</span></span>
<span><span class="co">#&gt; 1 2019-01-17 14:40:00  17    SensorDepth 0.16  NA  NA  NA  NA  NA  NA</span></span>
<span><span class="co">#&gt; 2 2019-01-17 14:40:00  17     WaterSpeed   NA  NA  NA  NA  NA  NA  NA</span></span>
<span><span class="co">#&gt; 3 2019-01-17 14:40:00  17 WaterDirection   NA  NA  NA  NA  NA  NA  NA</span></span>
<span><span class="co">#&gt; 4 2019-01-17 14:50:00  18    SensorDepth 0.16  NA  NA  NA  NA  NA  NA</span></span>
<span><span class="co">#&gt; 5 2019-01-17 14:50:00  18     WaterSpeed   NA  NA  NA  NA  NA  NA  NA</span></span>
<span><span class="co">#&gt; 6 2019-01-17 14:50:00  18 WaterDirection   NA  NA  NA  NA  NA  NA  NA</span></span></code></pre></div>
<p>This ADCP was deployed in January (AST), so 4 hours were added to each timestmap to convert to UTC.</p>
<p><code><a href="reference/adcp_pivot_longer.html">adcp_pivot_longer()</a></code> pivots the data so that bin heights are observations, and adds <a href="https://cfconventions.org/Data/cf-standard-names/current/build/cf-standard-name-table.html" class="external-link">Climate Forecast-compliant</a> names to each column.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/adcp_pivot_longer.html">adcp_pivot_longer</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 5</span></span>
<span><span class="co">#&gt;   timestamp_utc       sensor_depth_below_surface_m bin_height_…¹ sea_w…² sea_w…³</span></span>
<span><span class="co">#&gt;   &lt;dttm&gt;                                     &lt;dbl&gt;         &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 2019-01-17 15:10:00                         26.8           1.5   0.074    209.</span></span>
<span><span class="co">#&gt; 2 2019-01-17 15:10:00                         26.8           2.5   0.087    208.</span></span>
<span><span class="co">#&gt; 3 2019-01-17 15:10:00                         26.8           3.5   0.103    211.</span></span>
<span><span class="co">#&gt; 4 2019-01-17 15:10:00                         26.8           4.5   0.124    224.</span></span>
<span><span class="co">#&gt; 5 2019-01-17 15:10:00                         26.8           5.5   0.138    221.</span></span>
<span><span class="co">#&gt; 6 2019-01-17 15:10:00                         26.8           6.5   0.171    220.</span></span>
<span><span class="co">#&gt; # … with abbreviated variable names ¹​bin_height_above_sea_floor_m,</span></span>
<span><span class="co">#&gt; #   ²​sea_water_speed_m_s, ³​sea_water_to_direction_degree</span></span></code></pre></div>
<p><code>dat</code> is now in a useful format for analysis.</p>
<p>However, for submission to the <a href="https://data.novascotia.ca/" class="external-link">Nova Scotia Open Data Portal</a>, several additional steps are required.</p>
<p><code><a href="reference/adcp_calculate_bin_depth.html">adcp_calculate_bin_depth()</a></code> adds column <code>bin_depth_below_surface_m</code>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/adcp_calculate_bin_depth.html">adcp_calculate_bin_depth</a></span><span class="op">(</span><span class="va">dat</span>, metadata <span class="op">=</span> <span class="va">metadata</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 6</span></span>
<span><span class="co">#&gt;   timestamp_utc       sensor_depth_below_surfa…¹ bin_d…² bin_h…³ sea_w…⁴ sea_w…⁵</span></span>
<span><span class="co">#&gt;   &lt;dttm&gt;                                   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 2019-01-17 15:10:00                       26.8    25.8     1.5   0.074    209.</span></span>
<span><span class="co">#&gt; 2 2019-01-17 15:10:00                       26.8    24.8     2.5   0.087    208.</span></span>
<span><span class="co">#&gt; 3 2019-01-17 15:10:00                       26.8    23.8     3.5   0.103    211.</span></span>
<span><span class="co">#&gt; 4 2019-01-17 15:10:00                       26.8    22.8     4.5   0.124    224.</span></span>
<span><span class="co">#&gt; 5 2019-01-17 15:10:00                       26.8    21.8     5.5   0.138    221.</span></span>
<span><span class="co">#&gt; 6 2019-01-17 15:10:00                       26.8    20.8     6.5   0.171    220.</span></span>
<span><span class="co">#&gt; # … with abbreviated variable names ¹​sensor_depth_below_surface_m,</span></span>
<span><span class="co">#&gt; #   ²​bin_depth_below_surface_m, ³​bin_height_above_sea_floor_m,</span></span>
<span><span class="co">#&gt; #   ⁴​sea_water_speed_m_s, ⁵​sea_water_to_direction_degree</span></span></code></pre></div>
<p><code><a href="reference/adcp_add_opendata_cols.html">adcp_add_opendata_cols()</a></code> adds <code>deployment_id</code>, <code>waterbody</code>, and <code>station</code> columns so the data can be compiled with other deployments.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/adcp_add_opendata_cols.html">adcp_add_opendata_cols</a></span><span class="op">(</span><span class="va">dat</span>, metadata <span class="op">=</span> <span class="va">metadata</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 9</span></span>
<span><span class="co">#&gt;   deployme…¹ water…² station timestamp_utc       senso…³ bin_d…⁴ bin_h…⁵ sea_w…⁶</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;      &lt;chr&gt;   &lt;chr&gt;   &lt;dttm&gt;                &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 DG009      St. Ma… Long B… 2019-01-17 15:10:00    26.8    25.8     1.5   0.074</span></span>
<span><span class="co">#&gt; 2 DG009      St. Ma… Long B… 2019-01-17 15:10:00    26.8    24.8     2.5   0.087</span></span>
<span><span class="co">#&gt; 3 DG009      St. Ma… Long B… 2019-01-17 15:10:00    26.8    23.8     3.5   0.103</span></span>
<span><span class="co">#&gt; 4 DG009      St. Ma… Long B… 2019-01-17 15:10:00    26.8    22.8     4.5   0.124</span></span>
<span><span class="co">#&gt; 5 DG009      St. Ma… Long B… 2019-01-17 15:10:00    26.8    21.8     5.5   0.138</span></span>
<span><span class="co">#&gt; 6 DG009      St. Ma… Long B… 2019-01-17 15:10:00    26.8    20.8     6.5   0.171</span></span>
<span><span class="co">#&gt; # … with 1 more variable: sea_water_to_direction_degree &lt;dbl&gt;, and abbreviated</span></span>
<span><span class="co">#&gt; #   variable names ¹​deployment_id, ²​waterbody, ³​sensor_depth_below_surface_m,</span></span>
<span><span class="co">#&gt; #   ⁴​bin_depth_below_surface_m, ⁵​bin_height_above_sea_floor_m,</span></span>
<span><span class="co">#&gt; #   ⁶​sea_water_speed_m_s</span></span></code></pre></div>
<p><code><a href="reference/adcp_flag_data.html">adcp_flag_data()</a></code> flags obervations where <code>sensor_depth_below_surface_m</code> changes faster than expected.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/adcp_flag_data.html">adcp_flag_data</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dat</span><span class="op">[</span>, <span class="fl">6</span><span class="op">:</span><span class="fl">11</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 6</span></span>
<span><span class="co">#&gt;   bin_depth_below_surface_m bin_height_above_s…¹ sea_w…² sea_w…³ depth…⁴ depth…⁵</span></span>
<span><span class="co">#&gt;                       &lt;dbl&gt;                &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;glue&gt; </span></span>
<span><span class="co">#&gt; 1                      25.8                  1.5   0.074    209.    1.55 sensor…</span></span>
<span><span class="co">#&gt; 2                      24.8                  2.5   0.087    208.    1.55 sensor…</span></span>
<span><span class="co">#&gt; 3                      23.8                  3.5   0.103    211.    1.55 sensor…</span></span>
<span><span class="co">#&gt; 4                      22.8                  4.5   0.124    224.    1.55 sensor…</span></span>
<span><span class="co">#&gt; 5                      21.8                  5.5   0.138    221.    1.55 sensor…</span></span>
<span><span class="co">#&gt; 6                      20.8                  6.5   0.171    220.    1.55 sensor…</span></span>
<span><span class="co">#&gt; # … with abbreviated variable names ¹​bin_height_above_sea_floor_m,</span></span>
<span><span class="co">#&gt; #   ²​sea_water_speed_m_s, ³​sea_water_to_direction_degree, ⁴​depth_diff,</span></span>
<span><span class="co">#&gt; #   ⁵​depth_flag</span></span></code></pre></div>
<p>All of these steps can be linked using the pipe operator:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/adcp_read_txt.html">adcp_read_txt</a></span><span class="op">(</span><span class="va">path</span>, <span class="st">"2019-01-17_Long_Beach.txt"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="reference/adcp_assign_altitude.html">adcp_assign_altitude</a></span><span class="op">(</span><span class="va">metadata</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="reference/adcp_correct_timestamp.html">adcp_correct_timestamp</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="reference/adcp_pivot_longer.html">adcp_pivot_longer</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="reference/adcp_calculate_bin_depth.html">adcp_calculate_bin_depth</a></span><span class="op">(</span><span class="va">metadata</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="reference/adcp_add_opendata_cols.html">adcp_add_opendata_cols</a></span><span class="op">(</span><span class="va">metadata</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="reference/adcp_flag_data.html">adcp_flag_data</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 11</span></span>
<span><span class="co">#&gt;   deployme…¹ water…² station timestamp_utc       senso…³ bin_d…⁴ bin_h…⁵ sea_w…⁶</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;      &lt;chr&gt;   &lt;chr&gt;   &lt;dttm&gt;                &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 DG009      St. Ma… Long B… 2019-01-17 15:10:00    26.8    25.8     1.5   0.074</span></span>
<span><span class="co">#&gt; 2 DG009      St. Ma… Long B… 2019-01-17 15:10:00    26.8    24.8     2.5   0.087</span></span>
<span><span class="co">#&gt; 3 DG009      St. Ma… Long B… 2019-01-17 15:10:00    26.8    23.8     3.5   0.103</span></span>
<span><span class="co">#&gt; 4 DG009      St. Ma… Long B… 2019-01-17 15:10:00    26.8    22.8     4.5   0.124</span></span>
<span><span class="co">#&gt; 5 DG009      St. Ma… Long B… 2019-01-17 15:10:00    26.8    21.8     5.5   0.138</span></span>
<span><span class="co">#&gt; 6 DG009      St. Ma… Long B… 2019-01-17 15:10:00    26.8    20.8     6.5   0.171</span></span>
<span><span class="co">#&gt; # … with 3 more variables: sea_water_to_direction_degree &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   depth_diff &lt;dbl&gt;, depth_flag &lt;glue&gt;, and abbreviated variable names</span></span>
<span><span class="co">#&gt; #   ¹​deployment_id, ²​waterbody, ³​sensor_depth_below_surface_m,</span></span>
<span><span class="co">#&gt; #   ⁴​bin_depth_below_surface_m, ⁵​bin_height_above_sea_floor_m,</span></span>
<span><span class="co">#&gt; #   ⁶​sea_water_speed_m_s</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="plot-data">Plot data<a class="anchor" aria-label="anchor" href="#plot-data"></a>
</h3>
<p>Plot the sensor depth to determine if any observations should be trimmed.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/adcp_plot_depth_flags.html">adcp_plot_depth_flags</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-fig4-1.png" width="100%"></p>
<p>Filter data to keep “good” obsevations.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">dat</span>, <span class="va">depth_flag</span> <span class="op">==</span> <span class="st">"good"</span><span class="op">)</span></span></code></pre></div>
<p>Plot sensor depth:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/adcp_plot_depth.html">adcp_plot_depth</a></span><span class="op">(</span><span class="va">dat</span>, geom <span class="op">=</span> <span class="st">"line"</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-fig5-1.png" width="100%"></p>
<p>Plot current rose:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">viridis</a></span><span class="op">(</span><span class="fl">12</span>, option <span class="op">=</span> <span class="st">"F"</span>, direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ints</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/adcp_count_obs.html">adcp_count_obs</a></span><span class="op">(</span><span class="va">dat</span>, <span class="va">sea_water_speed_m_s</span><span class="op">)</span></span>
<span><span class="co">#&gt; Lower bound of first interval set to 0</span></span>
<span><span class="va">breaks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">ints</span><span class="op">$</span><span class="va">lower</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">ints</span><span class="op">$</span><span class="va">upper</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span></span>
<span><span class="fu"><a href="reference/adcp_plot_current_rose.html">adcp_plot_current_rose</a></span><span class="op">(</span></span>
<span>  <span class="va">dat</span>, </span>
<span>  breaks <span class="op">=</span> <span class="va">breaks</span>, </span>
<span>  speed_cols <span class="op">=</span> <span class="va">cols</span>,</span>
<span>  speed_label <span class="op">=</span> <span class="st">"Current Speed (m/s)"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-fig6-1.png" width="100%"></p>
<p>Plot current speed histogram.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="fu"><a href="reference/adcp_plot_speed_hist.html">adcp_plot_speed_hist</a></span><span class="op">(</span><span class="va">ints</span>, bar_cols <span class="op">=</span> <span class="va">cols</span>, speed_label <span class="op">=</span> <span class="st">"Current Speed (m/s)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-fig7-1.png" width="100%"></p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small>GPL (&gt;= 3)</small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing adcp</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Danielle Dempsey <br><small class="roles"> Maintainer </small>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://www.gnu.org/licenses/gpl-3.0" class="external-link"><img src="https://img.shields.io/badge/License-GPLv3-blue.svg" alt="License: GPL v3"></a></li>
<li><a href="https://github.com/dempsey-CMAR/adcp" class="external-link"><img src="https://img.shields.io/badge/devel%20version-1.0.2-blue.svg"></a></li>
<li><a href="https://www.codefactor.io/repository/github/dempsey-CMAR/adcp" class="external-link"><img src="https://www.codefactor.io/repository/github/dempsey-CMAR/adcp/badge" alt="CodeFactor"></a></li>
<li><a href="https://github.com/dempsey-CMAR/adcp/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/dempsey-CMAR/adcp/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Danielle Dempsey.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
